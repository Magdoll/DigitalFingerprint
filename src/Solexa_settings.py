import os,re,sys,fnmatch,operator,itertools,functools
import threading, time, math, datetime, random, bisect
from collections import defaultdict, namedtuple, deque
from cPickle import *

import numpy as np

from Bio import SeqIO
from Bio.Seq import Seq, MutableSeq

BowTieMatch = namedtuple('BowTieMatch', 'name strand ref_seq_id offset read quality bpq')

SOLEXA_PHRED_OFFSET = 64
BOWTIE_PHRED_OFFSET = 33

NT_MAPPING = {'N':0, 'A':1, 'U':2, 'T':2, 'G':3, 'C':4}
NT_GAPS = ('.', '-')

MIN_PHRED_SCORE  = 10 # all reads containing at least 1 position with phred < this will be ditched
BADPHRED_CUTOFF = 20 # bases with score lower than this won't count during # of mismatches

MIN_SNEAK_FIT_WEIGHT = .5

TYPICAL_READ_LEN = 51

MIN_DI_COUNT = 50 # positions with total count N lower than this won't calculate DI

def convert_phred_Solexa_to_BowTie(quality):
	new_quality = ''
	for x in quality:
		new_quality += chr(ord(x) - SOLEXA_PHRED_OFFSET + BOWTIE_PHRED_OFFSET)

	return new_quality

L2 = [338, 338.5, 338.5, 339, 340, 341, 342, 342.5, 343, 343.5, 344, 345, 345.5, 346, 347, 347.5, 348, 348.5, 349, 349.5, 350, 351, 352, 352.5, 353, 353.5, 354, 355, 355.5, 356, 356.5, 357, 357.5, 358, 358.5, 359, 359.5, 359.5, 360, 360.5, 361, 361.5, 362, 362.5, 363, 363.5, 364, 365, 366, 366.5, 367, 368, 369, 370, 370.5, 371, 372, 372.5, 373, 374, 374.5, 375, 376, 377, 377.5, 377.5, 378, 379, 379.5, 380, 381, 381.5, 382, 382.5, 382.5, 383, 383.5, 384, 384.5, 385, 385.5, 386, 386.5, 387, 387.5, 388, 389, 389.5, 390, 390.5, 391, 391.5, 392, 392.5, 393, 393.5, 394, 395, 395.5, 396, 396.5, 397, 397.5, 397.5, 398, 398.5, 399, 400, 401, 401.5, 402, 402.5, 403, 403.5, 404, 404.5, 405, 405.5, 405.5, 405.5, 405.5, 405.5, 405.5, 405.5, 405.5, 405.5, 405.5, 405.5, 405.5, 406, 406.5, 407, 407.5, 408, 408.5, 408.5, 409, 409.5, 410, 411, 411.5, 411.5, 411.5, 411.5, 412, 412.5, 413, 413.5, 413.5, 414, 414.5, 415, 416, 416.5, 417, 417.5, 418, 419, 419.5, 419.5, 419.5, 419.5, 420, 421, 421.5, 422, 423, 423.5, 423.5, 424, 424.5, 425, 425.5, 426, 426.5, 427, 427.5, 428, 428.5, 429, 429.5, 430, 430.5, 430.5, 431, 432, 432.5, 433, 433.5, 434, 434.5, 435, 436, 436.5, 436.5, 436.5, 437, 438, 438.5, 439, 440, 440.5, 441, 441.5, 442, 442.5, 442.5, 443, 443.5, 444, 445, 446, 446.5, 446.5, 446.5, 446.5, 447, 447.5, 447.5, 448, 448.5, 449, 449.5, 449.5, 450, 450.5, 450.5, 450.5, 451, 452, 452.5, 452.5, 453, 454, 455, 455.5, 456, 456.5, 456.5, 456.5, 457, 457.5, 458, 458.5, 459, 459.5, 459.5, 460, 460.5, 461, 461.5, 461.5, 462, 462.5, 462.5, 462.5, 462.5, 462.5, 462.5, 462.5, 462.5, 462.5, 462.5, 462.5, 462.5, 462.5, 462.5, 462.5, 462.5, 462.5, 462.5, 462.5, 462.5, 462.5, 462.5, 462.5, 462.5, 463, 463.5, 463.5, 464, 464.5, 464.5, 464.5, 464.5, 464.5, 464.5, 464.5, 464.5, 464.5, 464.5, 464.5, 464.5, 464.5, 464.5, 464.5, 464.5, 464.5, 464.5, 464.5, 464.5, 464.5, 465, 466, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 466.5, 467, 467.5, 467.5, 468, 468.5, 468.5, 468.5, 468.5, 469, 469.5, 469.5, 469.5, 469.5, 469.5, 469.5, 469.5, 469.5, 469.5, 469.5, 469.5, 469.5, 469.5, 469.5, 469.5, 470, 471, 471.5, 471.5, 472, 472.5, 473, 474, 475, 475.5, 476, 476.5, 477, 478, 478.5, 479, 479.5, 480, 480.5, 481, 481.5, 482, 482.5, 483, 483.5, 484, 484.5, 484.5, 484.5, 484.5, 484.5, 485, 485.5, 486, 486.5, 486.5, 486.5, 487, 487.5, 488, 488.5, 489, 490, 490.5, 490.5, 490.5, 490.5, 490.5, 490.5, 490.5, 490.5, 491, 491.5, 492, 492.5, 493, 493.5, 494, 494.5, 494.5, 494.5, 494.5, 494.5, 494.5, 494.5, 494.5, 494.5, 495, 495.5, 496, 496.5, 496.5, 496.5, 496.5, 496.5, 496.5, 496.5, 496.5, 496.5, 497, 497.5, 497.5, 498, 499, 499.5, 499.5, 499.5, 499.5, 499.5, 499.5, 499.5, 499.5, 499.5, 499.5, 500, 501, 501.5, 502, 502.5, 502.5, 503, 504, 504.5, 505, 505.5, 505.5, 505.5, 506, 506.5, 507, 507.5, 508, 509, 510, 510.5, 511, 511.5, 511.5, 512, 512.5, 513, 513.5, 514, 514.5, 514.5, 515, 515.5, 516, 516.5, 517, 517.5, 518, 519, 520, 520.5, 520.5, 521, 522, 522.5, 522.5, 523, 523.5, 524, 524.5, 525, 525.5, 525.5, 526, 527, 527.5, 528, 529, 530, 530.5, 530.5, 531, 532, 532.5, 533, 534, 534.5, 534.5, 534.5, 535, 536, 536.5, 536.5, 537, 538, 538.5, 539, 540, 540.5, 541, 542, 543, 543.5, 543.5, 543.5, 544, 545, 546, 546.5, 547, 547.5, 548, 548.5, 548.5, 549, 549.5, 550, 550.5, 551, 552, 552.5, 553, 554, 554.5, 555, 555.5, 556, 557, 558, 558.5, 559, 560, 560.5, 561, 562, 562.5, 563, 563.5, 563.5, 564, 564.5, 565, 565.5, 565.5, 566, 567, 567.5, 568, 569, 569.5, 569.5, 569.5, 570, 571, 571.5, 571.5, 572, 573, 574, 575, 576, 576.5, 577, 578, 578.5, 579, 580, 580.5, 580.5, 581, 581.5, 582, 583, 583.5, 584, 584.5, 585, 585.5, 586, 586.5, 587, 587.5, 587.5, 587.5, 587.5, 587.5, 587.5, 588, 588.5, 588.5, 589, 589.5, 590, 591, 591.5, 592, 592.5, 593, 593.5, 594, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 594.5, 595, 596, 596.5, 596.5, 596.5, 596.5, 597, 597.5, 598, 598.5, 599, 599.5, 600, 601]

